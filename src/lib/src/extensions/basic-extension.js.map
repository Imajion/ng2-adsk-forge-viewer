{"version":3,"file":"basic-extension.js","sourceRoot":"","sources":["basic-extension.ts"],"names":[],"mappings":"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","sourcesContent":["interface EventSubscription {\n  caller: Object;\n  eventName: string;\n  callback: (args: any) => void;\n}\n\nexport class BasicExtension {\n  public static extensionName: string = 'BasicExtension';\n\n  // TODO: Refactor to use RxJS -- could be a subject and we could return an observable\n  private static supscriptions: { [key: string]: EventSubscription[] } = {};\n\n  private viewer: Autodesk.Viewing.Viewer3D;\n  private extOptions: Autodesk.Viewing.ExtensionOptions;\n\n  private readonly events: string[] = [\n    Autodesk.Viewing.FIT_TO_VIEW_EVENT,\n    Autodesk.Viewing.FULLSCREEN_MODE_EVENT,\n    Autodesk.Viewing.GEOMETRY_LOADED_EVENT,\n    Autodesk.Viewing.HIDE_EVENT,\n    Autodesk.Viewing.ISOLATE_EVENT,\n    Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,\n    Autodesk.Viewing.OBJECT_TREE_UNAVAILABLE_EVENT,\n    Autodesk.Viewing.RESET_EVENT,\n    Autodesk.Viewing.SELECTION_CHANGED_EVENT,\n    Autodesk.Viewing.SHOW_EVENT,\n  ];\n\n  static registerExtension() {\n    Autodesk.Viewing.theExtensionManager.registerExtension(this.extensionName, BasicExtension);\n  }\n\n  static unregisterExtension() {\n    Autodesk.Viewing.theExtensionManager.unregisterExtension(this.extensionName);\n  }\n\n  static onViewerEvent(args: Autodesk.Viewing.ViewerEventArgs) {\n    // console.log('Event fired', args);\n    BasicExtension.publishEvent(args.type, args);\n  }\n\n  static subscribeEvent(caller: Object, eventName: string, callback: (args: Autodesk.Viewing.ViewerEventArgs) => void) {\n    const info: EventSubscription = { caller, eventName, callback };\n\n    if (!this.supscriptions[info.eventName]) {\n      this.supscriptions[info.eventName] = [];\n    }\n\n    const alreadySubscribed = this.supscriptions[info.eventName].find(item => item.caller === info.caller);\n    if (!alreadySubscribed) {\n      this.supscriptions[info.eventName].push(info);\n    }\n  }\n\n  static unsubscribeEvent(caller: Object, eventName: string) {\n    if (!this.supscriptions[eventName]) return;\n\n    const subscriber = this.supscriptions[eventName].find(item => item.caller === caller);\n    if (subscriber) {\n      const index = this.supscriptions[eventName].indexOf(subscriber);\n      this.supscriptions[eventName].splice(index, 1);\n    }\n  }\n\n  private static publishEvent(eventName: string, args: Autodesk.Viewing.ViewerEventArgs) {\n    const subscribers: EventSubscription[] = BasicExtension.supscriptions[eventName];\n\n    if (!subscribers || subscribers.length === 0) return;\n    subscribers.forEach(item => item.callback(args));\n  }\n\n  constructor(viewer: Autodesk.Viewing.Viewer3D, options: Autodesk.Viewing.ExtensionOptions) {\n    this.viewer = viewer;\n    this.extOptions = options;\n  }\n\n  load() {\n    this.events.forEach((eventName) => {\n      this.viewer.addEventListener(eventName, BasicExtension.onViewerEvent.bind(this));\n    });\n\n    console.log(BasicExtension.extensionName, 'loaded!');\n    return true;\n  }\n\n  unload() {\n    this.events.forEach((eventName) => {\n      this.viewer.removeEventListener(eventName, BasicExtension.onViewerEvent.bind(this));\n    });\n\n    console.log(BasicExtension.extensionName, 'unloaded!');\n    return true;\n  }\n}\n"]}