{"version":3,"file":"viewer.component.js","sourceRoot":"","sources":["viewer.component.ts"],"names":[],"mappings":"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","sourcesContent":["///<reference path=\"viewer-typings.d.ts\"/>\nimport { ChangeDetectionStrategy, Component, EventEmitter, Input, OnChanges, OnDestroy,\n  Output, SimpleChanges } from '@angular/core';\n\nimport { ScriptService } from '../service/script.service';\nimport { BasicExtension } from '../extensions/basic-extension';\n\ndeclare const require: any;\nconst VER_STRING = '?v=4.*.*';\n\nexport interface DocumentChangedEvent {\n  document: Autodesk.Viewing.Document;\n  viewingApplication: Autodesk.Viewing.ViewingApplication;\n  viewerComponent: ViewerComponent;\n}\n\nexport interface ItemLoadedEvent {\n  item: Autodesk.Viewing.ViewerItem;\n  viewingApplication: Autodesk.Viewing.ViewingApplication;\n  currentViewer: Autodesk.Viewing.Viewer3D;\n  viewerComponent: ViewerComponent;\n}\n\nexport interface ViewingApplicationInitializedEvent {\n  viewingApplication: Autodesk.Viewing.ViewingApplication;\n  viewerComponent: ViewerComponent;\n}\n\nexport interface ViewerOptions {\n  initializerOptions: Autodesk.Viewing.InitializerOptions;\n  viewerApplicationOptions?: Autodesk.Viewing.ViewingApplicationOptions;\n  viewerConfig?: Autodesk.Viewing.ViewerConfig;\n  headlessViewer?: boolean;\n  showFirstViewable?: boolean;\n  versionString?: string;\n}\n\n\n@Component({\n  selector: 'adsk-forge-viewer',\n  templateUrl: './viewer.component.html',\n  styleUrls: ['./viewer.component.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class ViewerComponent implements OnChanges, OnDestroy {\n  readonly containerId = 'ng2-adsk-forge-viewer-container';\n\n  @Input() public viewerOptions: ViewerOptions;\n\n  @Output() public onViewerScriptsLoaded = new EventEmitter<boolean>();\n  @Output() public onViewingApplicationInitialized = new EventEmitter<ViewingApplicationInitializedEvent>();\n  @Output() public onDocumentChanged = new EventEmitter<DocumentChangedEvent>();\n  @Output() public onItemLoaded = new EventEmitter<ItemLoadedEvent>();\n  @Output() public onError = new EventEmitter<Autodesk.Viewing.ErrorCodes>();\n\n  // Viewer events\n  @Output() public onFitToView = new EventEmitter<Autodesk.Viewing.FitToViewEventArgs>();\n  @Output() public onFullscreen = new EventEmitter<Autodesk.Viewing.FullscreenEventArgs>();\n  @Output() public onGeometryLoaded = new EventEmitter<Autodesk.Viewing.GeometryLoadedEventArgs>();\n  @Output() public onHide = new EventEmitter<Autodesk.Viewing.HideEventArgs>();\n  @Output() public onIsolate = new EventEmitter<Autodesk.Viewing.IsolateEventArgs>();\n  @Output() public onObjectTreeCreated = new EventEmitter<Autodesk.Viewing.ObjectTreeEventArgs>();\n  @Output() public onObjectTreeUnavailable = new EventEmitter<Autodesk.Viewing.ObjectTreeEventArgs>();\n  @Output() public onReset = new EventEmitter<Autodesk.Viewing.ViewerEventArgs>();\n  @Output() public onSelectionChanged = new EventEmitter<Autodesk.Viewing.SelectionChangedEventArgs>();\n  @Output() public onShow = new EventEmitter<Autodesk.Viewing.ShowEventArgs>();\n\n\n  private viewerInitialized = false;\n  private viewerApp: Autodesk.Viewing.ViewingApplication;\n  private documentId: string;\n\n  /**\n   * Helper to allow callers to specify documentId with or without the required urn: prefix\n   */\n  private static verifyUrn(documentId: string): string {\n    return (documentId.startsWith('urn:')) ? documentId : `urn:${documentId}`;\n  }\n\n  constructor(private script: ScriptService) {\n    this.loadScripts();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (!this.viewerInitialized && changes.viewerOptions && changes.viewerOptions.currentValue) {\n      this.initialiseApplication();\n    }\n  }\n\n  ngOnDestroy() {\n    this.unregisterBasicExtension();\n\n    if (this.viewerApp) {\n      const viewer = this.viewerApp.getCurrentViewer();\n      viewer.tearDown();\n      viewer.uninitialize();\n    }\n\n    this.viewerApp = null;\n    this.viewerInitialized = false;\n  }\n\n  /**\n   * Helper method to get some default viewer options\n   */\n  getDefaultViewerOptions(getAccessToken: (onGetAccessToken: (token: string, expire: number) => void) => void)\n  : ViewerOptions {\n    return {\n      initializerOptions: {\n        env: 'AutodeskProduction',\n        getAccessToken,\n      },\n    };\n  }\n\n  /**\n   * Get a reference to the current viewing application\n   */\n  public get ViewerApplication() {\n    return this.viewerApp;\n  }\n\n  /**\n   * Get a reference to the current 3D viewer\n   */\n  public get Viewer3D() {\n    return this.viewerApp.getCurrentViewer();\n  }\n\n  public get DocumentId() {\n    return this.documentId;\n  }\n\n  public set DocumentId(value: string) {\n    this.documentId = value;\n    this.loadDocument(this.documentId);\n  }\n\n  public selectItem(item: Autodesk.Viewing.ViewerItem|Autodesk.Viewing.BubbleNode) {\n    this.viewerApp.selectItem(item, this.onItemLoadSuccess.bind(this), this.onItemLoadFail.bind(this));\n  }\n\n  /**\n   * We don't bundle Autodesk's scripts with the component, and we don't really want users to have\n   * to add the scripts to their index.html pages. So we'll load them when required.\n   */\n  private loadScripts() {\n    this.script.load(\n      'https://developer.api.autodesk.com/modelderivative/v2/viewers/three.min.js?v=4.*.*',\n      'https://developer.api.autodesk.com/modelderivative/v2/viewers/viewer3D.min.js?v=4.*.*',\n    )\n      .then((data) => {\n        console.log('script loaded ', data);\n        this.onViewerScriptsLoaded.emit(true);\n      })\n      .catch(error => console.log(error));\n  }\n\n  /**\n   * Initialises a ViewingApplication\n   */\n  private initialiseApplication() {\n    // Check if the viewer has already been initialised - this isn't the nicest, but we've set the env in our\n    // options above so we at least know that it was us who did this!\n    if (!Autodesk.Viewing.Private.env) {\n      Autodesk.Viewing.Initializer(this.viewerOptions.initializerOptions, () => {\n        this.initialized();\n      });\n    } else {\n      // We need to give an initialised viewing application a tick to allow the DOM element\n      // to be established before we re-draw\n      setTimeout(() => {\n        this.initialized();\n      });\n    }\n  }\n\n  private initialized() {\n    this.viewerApp = new Autodesk.Viewing.ViewingApplication(this.containerId,\n                                                             this.viewerOptions.viewerApplicationOptions);\n\n    // Register an extension to help us raise events\n    const extName = this.registerBasicExtension();\n    const config = this.addBasicExtensionConfig(extName);\n\n    // Register a viewer with the application (passign through any additional config)\n    this.viewerApp.registerViewer(\n      this.viewerApp.k3D,\n      (this.viewerOptions.headlessViewer) ? Autodesk.Viewing.Viewer3D : Autodesk.Viewing.Private.GuiViewer3D,\n      config,\n    );\n\n    // Viewer is ready - scripts are loaded and we've create a new viewing application\n    this.viewerInitialized = true;\n    this.onViewingApplicationInitialized.emit({ viewingApplication: this.viewerApp, viewerComponent: this });\n  }\n\n  /**\n   * Loads a model in to the viewer via it's urn\n   */\n  private loadDocument(documentId: string) {\n    if (!documentId) return;\n\n    // Add urn: to the beginning of document id if needed\n    this.viewerApp.loadDocument(ViewerComponent.verifyUrn(documentId),\n                                this.onDocumentLoadSuccess.bind(this),\n                                this.onDocumentLoadFailure.bind(this));\n  }\n\n  /**\n   * Document successfully loaded\n   */\n  private onDocumentLoadSuccess(document: Autodesk.Viewing.Document) {\n    // Emit an event so the caller can do something\n    // TODO: config option to specify which viewable to display (how?)\n    this.onDocumentChanged.emit({ document, viewingApplication: this.viewerApp, viewerComponent: this });\n\n    if (this.viewerOptions.showFirstViewable === undefined || this.viewerOptions.showFirstViewable) {\n      // This will be the default behaviour -- show the first viewable\n      // We could still make use of Document.getSubItemsWithProperties()\n      // However, when using a ViewingApplication, we have access to the **bubble** attribute,\n      // which references the root node of a graph that wraps each object from the Manifest JSON.\n      const viewables = this.viewerApp.bubble.search(Autodesk.Viewing.BubbleNode.MODEL_NODE);\n\n      if (viewables && viewables.length > 0) {\n        this.viewerApp.selectItem(viewables[0].data, this.onItemLoadSuccess.bind(this), this.onItemLoadFail.bind(this));\n      }\n    }\n  }\n\n  /**\n   * Failed to load document\n   */\n  private onDocumentLoadFailure(errorCode: Autodesk.Viewing.ErrorCodes) {\n    console.error('onDocumentLoadFailure() - errorCode:' + errorCode);\n    this.onError.emit(errorCode);\n  }\n\n  /**\n   * View from the document was successfully loaded\n   */\n  private onItemLoadSuccess(viewer: Autodesk.Viewing.Viewer3D, item: Autodesk.Viewing.ViewerItem) {\n    console.log('onItemLoadSuccess()', viewer, item);\n    console.log('Viewers are equal: ' + (viewer === this.viewerApp.getCurrentViewer()));\n\n    this.onItemLoaded.emit({\n      item, currentViewer: viewer,\n      viewingApplication: this.viewerApp,\n      viewerComponent: this,\n    });\n  }\n\n  /**\n   * Failed to load a view from the document\n   */\n  private onItemLoadFail(errorCode: Autodesk.Viewing.ErrorCodes) {\n    console.error('onItemLoadFail() - errorCode:' + errorCode);\n    this.onError.emit(errorCode);\n  }\n\n  private registerBasicExtension(): string {\n    BasicExtension.registerExtension();\n\n    // tslint:disable:max-line-length\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.FIT_TO_VIEW_EVENT, (args: Autodesk.Viewing.FitToViewEventArgs) => this.onFitToView.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.FULLSCREEN_MODE_EVENT, (args: Autodesk.Viewing.FullscreenEventArgs) => this.onFullscreen.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.GEOMETRY_LOADED_EVENT, (args: Autodesk.Viewing.GeometryLoadedEventArgs) => this.onGeometryLoaded.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.HIDE_EVENT, (args: Autodesk.Viewing.HideEventArgs) => this.onHide.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.ISOLATE_EVENT, (args: Autodesk.Viewing.IsolateEventArgs) => this.onIsolate.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT, (args: Autodesk.Viewing.ObjectTreeEventArgs) => this.onObjectTreeCreated.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.OBJECT_TREE_UNAVAILABLE_EVENT, (args: Autodesk.Viewing.ObjectTreeEventArgs) => this.onObjectTreeCreated.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.RESET_EVENT, (args: Autodesk.Viewing.ViewerEventArgs) => this.onReset.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.SELECTION_CHANGED_EVENT, (args: Autodesk.Viewing.SelectionChangedEventArgs) => this.onSelectionChanged.emit(args));\n    BasicExtension.subscribeEvent(this, Autodesk.Viewing.SHOW_EVENT, (args: Autodesk.Viewing.ShowEventArgs) => this.onShow.emit(args));\n    // tslint:enable:max-line-length\n\n    return BasicExtension.extensionName;\n  }\n\n  private unregisterBasicExtension() {\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.FIT_TO_VIEW_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.FULLSCREEN_MODE_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.GEOMETRY_LOADED_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.HIDE_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.ISOLATE_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.OBJECT_TREE_UNAVAILABLE_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.RESET_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.SELECTION_CHANGED_EVENT);\n    BasicExtension.unsubscribeEvent(this, Autodesk.Viewing.SHOW_EVENT);\n\n    BasicExtension.unregisterExtension();\n  }\n\n  private addBasicExtensionConfig(extName: string): Autodesk.Viewing.ViewerConfig {\n    const config: Autodesk.Viewing.ViewerConfig = Object.assign(\n      {},\n      this.viewerOptions.viewerConfig,\n      { extensions: [] },\n    );\n\n    // We will always load our basic extension with any others specified by the caller\n    if (this.viewerOptions.viewerConfig && this.viewerOptions.viewerConfig.extensions) {\n      config.extensions = [...this.viewerOptions.viewerConfig.extensions, extName];\n    } else {\n      config.extensions = [extName];\n    }\n\n    return config;\n  }\n}\n"]}